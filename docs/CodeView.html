<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>api.ts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../src/presentation/templates/uikit/uikit.min.css"/>
    <script src="../src/presentation/templates/uikit/uikit.min.js"></script>
    <script src="../src/presentation/templates/uikit/uikit-icons.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <style>
        pre {
            font: 12px/1.4 Consolas, "Liberation Mono", Menlo, Courier, monospace;
            margin: 0;
            padding: 0;
            -moz-tab-size: 2;
            -o-tab-size: 2;
            tab-size: 2;
        }

        table.coverage {
            border-collapse: collapse;
            margin: 10px 0 0 0;
            padding: 0;
        }

        table.coverage td {
            margin: 0;
            padding: 0;
            vertical-align: top;
        }

        table.coverage td.line-count {
            text-align: right;
            padding: 0 5px 0 20px;
            /*display: block;*/
        }

        table.coverage td.line-coverage {
            text-align: right;
            padding-right: 10px;
            min-width: 20px;
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            /*width: 100%;*/
        }
    </style>
</head>
<body class="uk-background-primary">
<pre>
<div class="uk-container">
    <ul class="uk-breadcrumb">
        <li><a href="Dashboard.html">Overview</a></li>
        <li><a href="ModuleView.html">@coder/logger</a></li>
        <li><span>api.ts</span></li>
    </ul>
    <table class="coverage">
        <tr>
            <td class="line-count">
                <a></a><a>1</a>
                <a></a><a>2</a>
                <a></a><a>3</a>
                <a></a><a>4</a>
                <a></a><a>5</a>
                <a></a><a>6</a>
                <a></a><a>7</a>
                <a></a><a>8</a>
                <a></a><a>9</a>
                <a></a><a>10</a>
                <a></a><a>11</a>
                <a></a><a>12</a>
                <a></a><a>13</a>
                <a></a><a>14</a>
                <a></a><a>15</a>
                <a></a><a>16</a>
                <a></a><a>17</a>
                <a></a><a>18</a>
                <a></a><a>19</a>
                <a></a><a>20</a>
                <a></a><a>21</a>
                <a></a><a>22</a>
                <a></a><a>23</a>
                <a></a><a>24</a>
                <a></a><a>25</a>
                <a></a><a>26</a>
                <a></a><a>27</a>
                <a></a><a>28</a>
                <a></a><a>29</a>
                <a></a><a>30</a>
                <a></a><a>31</a>
                <a></a><a>32</a>
                <a></a><a>33</a>
                <a></a><a>34</a>
                <a></a><a>35</a>
                <a></a><a>36</a>
                <a></a><a>37</a>
                <a></a><a>38</a>
                <a></a><a>39</a>
                <a></a><a>40</a>
                <a></a><a>41</a>
                <a></a><a>42</a>
                <a></a><a>43</a>
                <a></a><a>44</a>
                <a></a><a>45</a>
                <a></a><a>46</a>
                <a></a><a>47</a>
                <a></a><a>48</a>
                <a></a><a>49</a>
                <a></a><a>50</a>
                <a></a><a>51</a>
                <a></a><a>52</a>
                <a></a><a>53</a>
                <a></a><a>54</a>
                <a></a><a>55</a>
                <a></a><a>56</a>
                <a></a><a>57</a>
                <a></a><a>58</a>
                <a></a><a>59</a>
                <a></a><a>60</a>
                <a></a><a>61</a>
                <a></a><a>62</a>
                <a></a><a>63</a>
                <a></a><a>64</a>
                <a></a><a>65</a>
                <a></a><a>66</a>
                <a></a><a>67</a>
                <a></a><a>68</a>
                <a></a><a>69</a>
                <a></a><a>70</a>
                <a></a><a>71</a>
                <a></a><a>72</a>
                <a></a><a>73</a>
                <a></a><a>74</a>
                <a></a><a>75</a>
                <a></a><a>76</a>
                <a></a><a>77</a>
                <a></a><a>78</a>
                <a></a><a>79</a>
                <a></a><a>80</a>
                <a></a><a>81</a>
                <a></a><a>82</a>
                <a></a><a>83</a>
                <a></a><a>84</a>
                <a></a><a>85</a>
                <a></a><a>86</a>
                <a></a><a>87</a>
                <a></a><a>88</a>
                <a></a><a>89</a>
                <a></a><a>90</a>
                <a></a><a>91</a>
                <a></a><a>92</a>
                <a></a><a>93</a>
                <a></a><a>94</a>
                <a></a><a>95</a>
                <a></a><a>96</a>
                <a></a><a>97</a>
                <a></a><a>98</a>
                <a></a><a>99</a>
                <a></a><a>100</a>
                <a></a><a>101</a>
                <a></a><a>102</a>
                <a></a><a>103</a>
                <a></a><a>104</a>
                <a></a><a>105</a>
                <a></a><a>106</a>
                <a></a><a>107</a>
                <a></a><a>108</a>
                <a></a><a>109</a>
                <a></a><a>110</a>
                <a></a><a>111</a>
                <a></a><a>112</a>
                <a></a><a>113</a>
                <a></a><a>114</a>
                <a></a><a>115</a>
                <a></a><a>116</a>
                <a></a><a>117</a>
                <a></a><a>118</a>
                <a></a><a>119</a>
                <a></a><a>120</a>
                <a></a><a>121</a>
                <a></a><a>122</a>
                <a></a><a>123</a>
                <a></a><a>124</a>
                <a></a><a>125</a>
                <a></a><a>126</a>
                <a></a><a>127</a>
                <a></a><a>128</a>
                <a></a><a>129</a>
                <a></a><a>130</a>
                <a></a><a>131</a>
                <a></a><a>132</a>
                <a></a><a>133</a>
                <a></a><a>134</a>
                <a></a><a>135</a>
                <a></a><a>136</a>
                <a></a><a>137</a>
                <a></a><a>138</a>
                <a></a><a>139</a>
                <a></a><a>140</a>
                <a></a><a>141</a>
                <a></a><a>142</a>
                <a></a><a>143</a>
                <a></a><a>144</a>
                <a></a><a>145</a>
                <a></a><a>146</a>
                <a></a><a>147</a>
                <a></a><a>148</a>
                <a></a><a>149</a>
                <a></a><a>150</a>
                <a></a><a>151</a>
                <a></a><a>152</a>
                <a></a><a>153</a>
                <a></a><a>154</a>
                <a></a><a>155</a>
                <a></a><a>156</a>
                <a></a><a>157</a>
                <a></a><a>158</a>
                <a></a><a>159</a>
                <a></a><a>160</a>
                <a></a><a>161</a>
                <a></a><a>162</a>
                <a></a><a>163</a>
                <a></a><a>164</a>
                <a></a><a>165</a>
                <a></a><a>166</a>
                <a></a><a>167</a>
                <a></a><a>168</a>
                <a></a><a>169</a>
                <a></a><a>170</a>
                <a></a><a>171</a>
                <a></a><a>172</a>
                <a></a><a>173</a>
                <a></a><a>174</a>
                <a></a><a>175</a>
                <a></a><a>176</a>
                <a></a><a>177</a>
                <a></a><a>178</a>
                <a></a><a>179</a>
                <a></a><a>180</a>
                <a></a><a>181</a>
                <a></a><a>182</a>
                <a></a><a>183</a>
                <a></a><a>184</a>
                <a></a><a>185</a>
                <a></a><a>186</a>
                <a></a><a>187</a>
                <a></a><a>188</a>
                <a></a><a>189</a>
                <a></a><a>190</a>
                <a></a><a>191</a>
                <a></a><a>192</a>
                <a></a><a>193</a>
                <a></a><a>194</a>
                <a></a><a>195</a>
                <a></a><a>196</a>
                <a></a><a>197</a>
                <a></a><a>198</a>
                <a></a><a>199</a>
                <a></a><a>200</a>
                <a></a><a>201</a>
                <a></a><a>202</a>
                <a></a><a>203</a>
                <a></a><a>204</a>
                <a></a><a>205</a>
                <a></a><a>206</a>
                <a></a><a>207</a>
                <a></a><a>208</a>
                <a></a><a>209</a>
                <a></a><a>210</a>
                <a></a><a>211</a>
                <a></a><a>212</a>
                <a></a><a>213</a>
                <a></a><a>214</a>
                <a></a><a>215</a>
                <a></a><a>216</a>
                <a></a><a>217</a>
                <a></a><a>218</a>
                <a></a><a>219</a>
                <a></a><a>220</a>
                <a></a><a>221</a>
                <a></a><a>222</a>
                <a></a><a>223</a>
                <a></a><a>224</a>
                <a></a><a>225</a>
                <a></a><a>226</a>
                <a></a><a>227</a>
                <a></a><a>228</a>
                <a></a><a>229</a>
                <a></a><a>230</a>
                <a></a><a>231</a>
                <a></a><a>232</a>
                <a></a><a>233</a>
                <a></a><a>234</a>
                <a></a><a>235</a>
                <a></a><a>236</a>
                <a></a><a>237</a>
                <a></a><a>238</a>
                <a></a><a>239</a>
                <a></a><a>240</a>
                <a></a><a>241</a>
                <a></a><a>242</a>
                <a></a><a>243</a>
                <a></a><a>244</a>
                <a></a><a>245</a>
                <a></a><a>246</a>
                <a></a><a>247</a>
                <a></a><a>248</a>
                <a></a><a>249</a>
                <a></a><a>250</a>
                <a></a><a>251</a>
                <a></a><a>252</a>
                <a></a><a>253</a>
                <a></a><a>254</a>
                <a></a><a>255</a>
                <a></a><a>256</a>
                <a></a><a>257</a>
                <a></a><a>258</a>
                <a></a><a>259</a>
                <a></a><a>260</a>
                <a></a><a>261</a>
                <a></a><a>262</a>
                <a></a><a>263</a>
                <a></a><a>264</a>
                <a></a><a>265</a>
                <a></a><a>266</a>
                <a></a><a>267</a>
                <a></a><a>268</a>
                <a></a><a>269</a>
                <a></a><a>270</a>
                <a></a><a>271</a>
                <a></a><a>272</a>
                <a></a><a>273</a>
                <a></a><a>274</a>
                <a></a><a>275</a>
                <a></a><a>276</a>
                <a></a><a>277</a>
                <a></a><a>278</a>
                <a></a><a>279</a>
                <a></a><a>280</a>
                <a></a><a>281</a>
                <a></a><a>282</a>
                <a></a><a>283</a>
                <a></a><a>284</a>
                <a></a><a>285</a>
                <a></a><a>286</a>
                <a></a><a>287</a>
                <a></a><a>288</a>
                <a></a><a>289</a>
                <a></a><a>290</a>
                <a></a><a>291</a>
                <a></a><a>292</a>
                <a></a><a>293</a>
                <a></a><a>294</a>
                <a></a><a>295</a>
                <a></a><a>296</a>
                <a></a><a>297</a>
                <a></a><a>298</a>
                <a></a><a>299</a>
                <a></a><a>300</a>
                <a></a><a>301</a>
                <a></a><a>302</a>
                <a></a><a>303</a>
                <a></a><a>304</a>
                <a></a><a>305</a>
                <a></a><a>306</a>
                <a></a><a>307</a>
                <a></a><a>308</a>
                <a></a><a>309</a>
                <a></a><a>310</a>
                <a></a><a>311</a>
                <a></a><a>312</a>
            </td>
            <td class="line-coverage">
                <span class="cline-any cline-yes">1x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">2x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">2x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">1x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">2x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">1x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">3x</span>
                <span class="cline-any cline-yes">2x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">2x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes">2x</span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
                <span class="cline-any cline-yes"></span>
            </td>
            <td>
<pre class="prettyprint lang-js">import { field, logger } from "@coder/logger"
import * as cp from "child_process"
import * as fs from "fs-extra"
import * as http from "http"
import * as net from "net"
import * as path from "path"
import * as url from "url"
import * as WebSocket from "ws"
import {
  Application,
  ApplicationsResponse,
  ClientMessage,
  RecentResponse,
  ServerMessage,
  SessionError,
  SessionResponse,
} from "../../common/api"
import { ApiEndpoint, HttpCode, HttpError } from "../../common/http"
import { HttpProvider, HttpProviderOptions, HttpResponse, HttpServer, Route } from "../http"
import { findApplications, findWhitelistedApplications, Vscode } from "./bin"
import { VscodeHttpProvider } from "./vscode"

interface VsRecents {
  [key: string]: (string | { configURIPath: string })[]
}

type VsSettings = [string, string][]

/**
 * API HTTP provider.
 */
export class ApiHttpProvider extends HttpProvider {
  private readonly ws = new WebSocket.Server({ noServer: true })

  public constructor(
    options: HttpProviderOptions,
    private readonly server: HttpServer,
    private readonly vscode: VscodeHttpProvider,
    private readonly dataDir?: string,
  ) {
    super(options)
  }

  public async handleRequest(route: Route, request: http.IncomingMessage): Promise&lt;HttpResponse&gt; {
    this.ensureAuthenticated(request)
    if (!this.isRoot(route)) {
      throw new HttpError("Not found", HttpCode.NotFound)
    }

    switch (route.base) {
      case ApiEndpoint.applications:
        this.ensureMethod(request)
        return {
          mime: "application/json",
          content: {
            applications: await this.applications(),
          },
        } as HttpResponse&lt;ApplicationsResponse&gt;
      case ApiEndpoint.process:
        return this.process(request)
      case ApiEndpoint.recent:
        this.ensureMethod(request)
        return {
          mime: "application/json",
          content: await this.recent(),
        } as HttpResponse&lt;RecentResponse&gt;
    }

    throw new HttpError("Not found", HttpCode.NotFound)
  }

  public async handleWebSocket(
    route: Route,
    request: http.IncomingMessage,
    socket: net.Socket,
    head: Buffer,
  ): Promise&lt;void&gt; {
    if (!this.authenticated(request)) {
      throw new Error("not authenticated")
    }
    switch (route.base) {
      case ApiEndpoint.status:
        return this.handleStatusSocket(request, socket, head)
      case ApiEndpoint.run:
        return this.handleRunSocket(route, request, socket, head)
    }

    throw new HttpError("Not found", HttpCode.NotFound)
  }

  private async handleStatusSocket(request: http.IncomingMessage, socket: net.Socket, head: Buffer): Promise&lt;void&gt; {
    const getMessageResponse = async (event: "health"): Promise&lt;ServerMessage&gt; =&gt; {
      switch (event) {
        case "health":
          return { event, connections: await this.server.getConnections() }
        default:
          throw new Error("unexpected message")
      }
    }

    await new Promise&lt;WebSocket&gt;((resolve) =&gt; {
      this.ws.handleUpgrade(request, socket, head, (ws) =&gt; {
        const send = (event: ServerMessage): void =&gt; {
          ws.send(JSON.stringify(event))
        }
        ws.on("message", (data) =&gt; {
          logger.trace("got message", field("message", data))
          try {
            const message: ClientMessage = JSON.parse(data.toString())
            getMessageResponse(message.event).then(send)
          } catch (error) {
            logger.error(error.message, field("message", data))
          }
        })
        resolve()
      })
    })
  }

  /**
   * A socket that connects to the process.
   */
  private async handleRunSocket(
    _route: Route,
    request: http.IncomingMessage,
    socket: net.Socket,
    head: Buffer,
  ): Promise&lt;void&gt; {
    logger.debug("connecting to process")
    const ws = await new Promise&lt;WebSocket&gt;((resolve, reject) =&gt; {
      this.ws.handleUpgrade(request, socket, head, (socket) =&gt; {
        socket.binaryType = "arraybuffer"

        socket.on("error", (error) =&gt; {
          socket.close(SessionError.FailedToStart)
          logger.error("got error while connecting socket", field("error", error))
          reject(error)
        })

        resolve(socket as WebSocket)
      })
    })

    logger.debug("connected to process")

    // Send ready message.
    ws.send(
      Buffer.from(
        JSON.stringify({
          protocol: "TODO",
        }),
      ),
    )
  }

  /**
   * Return whitelisted applications.
   */
  public async applications(): Promise&lt;ReadonlyArray&lt;Application&gt;&gt; {
    return findWhitelistedApplications()
  }

  /**
   * Return installed applications.
   */
  public async installedApplications(): Promise&lt;ReadonlyArray&lt;Application&gt;&gt; {
    return findApplications()
  }

  /**
   * Handle /process endpoint.
   */
  private async process(request: http.IncomingMessage): Promise&lt;HttpResponse&gt; {
    this.ensureMethod(request, ["DELETE", "POST"])

    const data = await this.getData(request)
    if (!data) {
      throw new HttpError("No data was provided", HttpCode.BadRequest)
    }

    const parsed: Application = JSON.parse(data)

    switch (request.method) {
      case "DELETE":
        if (parsed.pid) {
          await this.killProcess(parsed.pid)
        } else if (parsed.path) {
          await this.killProcess(parsed.path)
        } else {
          throw new Error("No pid or path was provided")
        }
        return {
          mime: "application/json",
          code: HttpCode.Ok,
        }
      case "POST": {
        if (!parsed.exec) {
          throw new Error("No exec was provided")
        }
        return {
          mime: "application/json",
          content: {
            created: true,
            pid: await this.spawnProcess(parsed.exec),
          },
        } as HttpResponse&lt;SessionResponse&gt;
      }
    }

    throw new HttpError("Not found", HttpCode.NotFound)
  }

  /**
   * Kill a process identified by pid or path if a web app.
   */
  public async killProcess(pid: number | string): Promise&lt;void&gt; {
    if (typeof pid === "string") {
      switch (pid) {
        case Vscode.path:
          await this.vscode.dispose()
          break
        default:
          throw new Error(`Process "${pid}" does not exist`)
      }
    } else {
      process.kill(pid)
    }
  }

  /**
   * Spawn a process and return the pid.
   */
  public async spawnProcess(exec: string): Promise&lt;number&gt; {
    const proc = cp.spawn(exec, {
      shell: process.env.SHELL || true,
      env: {
        ...process.env,
      },
    })

    proc.on("error", (error) =&gt; logger.error("process errored", field("pid", proc.pid), field("error", error)))
    proc.on("exit", () =&gt; logger.debug("process exited", field("pid", proc.pid)))

    logger.debug("started process", field("pid", proc.pid))

    return proc.pid
  }

  /**
   * Return VS Code's recent paths.
   */
  public async recent(): Promise&lt;RecentResponse&gt; {
    try {
      if (!this.dataDir) {
        throw new Error("data directory is not set")
      }

      const state: VsSettings = JSON.parse(await fs.readFile(path.join(this.dataDir, "User/state/global.json"), "utf8"))
      const setting = Array.isArray(state) && state.find((item) =&gt; item[0] === "recently.opened")
      if (!setting) {
        return { paths: [], workspaces: [] }
      }

      const pathPromises: { [key: string]: Promise&lt;string&gt; } = {}
      const workspacePromises: { [key: string]: Promise&lt;string&gt; } = {}
      Object.values(JSON.parse(setting[1]) as VsRecents).forEach((recents) =&gt; {
        recents.forEach((recent) =&gt; {
          try {
            const target = typeof recent === "string" ? pathPromises : workspacePromises
            const pathname = url.parse(typeof recent === "string" ? recent : recent.configURIPath).pathname
            if (pathname && !target[pathname]) {
              target[pathname] = new Promise&lt;string&gt;((resolve) =&gt; {
                fs.stat(pathname)
                  .then(() =&gt; resolve(pathname))
                  .catch(() =&gt; resolve())
              })
            }
          } catch (error) {
            logger.debug("invalid path", field("path", recent))
          }
        })
      })

      const [paths, workspaces] = await Promise.all([
        Promise.all(Object.values(pathPromises)),
        Promise.all(Object.values(workspacePromises)),
      ])

      return {
        paths: paths.filter((p) =&gt; !!p),
        workspaces: workspaces.filter((p) =&gt; !!p),
      }
    } catch (error) {
      if (error.code !== "ENOENT") {
        throw error
      }
    }

    return { paths: [], workspaces: [] }
  }

  /**
   * For these, just return the error message since they'll be requested as
   * JSON.
   */
  public async getErrorRoot(_route: Route, _title: string, _header: string, error: string): Promise&lt;HttpResponse&gt; {
    return {
      mime: "application/json",
      content: JSON.stringify({ error }),
    }
  }
}
</pre>
            </td>
        </tr>
    </table>
</div>
    </pre>
</body>
</html>